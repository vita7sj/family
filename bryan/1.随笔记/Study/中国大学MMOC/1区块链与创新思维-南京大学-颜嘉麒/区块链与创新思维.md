# 初识区块链

- [初识区块链](#初识区块链)
   - [1.什么是区块链](#1什么是区块链)
      - [1.1.区块链的特点](#11区块链的特点)
      - [1.2.区块链起源与现状](#12区块链起源与现状)
         - [1.2.1.早期技术](#121早期技术)
         - [1.2.2.区块链的现状](#122区块链的现状)
         - [1.2.3.区块链未来发展](#123区块链未来发展)
      - [1.3.信任建立与形象解释](#13信任建立与形象解释)
         - [1.3.1.信任的建立](#131信任的建立)
         - [1.3.2.区块链的定义](#132区块链的定义)
         - [1.3.3.区块链的分类](#133区块链的分类)
      - [1.4.从信息互联网到价值物联网](#14从信息互联网到价值物联网)
         - [1.4.1.信息互联网](#141信息互联网)
         - [1.4.2.价值物联网](#142价值物联网)
      - [1.5.区块链的神话与误解](#15区块链的神话与误解)
         - [1.5.1.区块链不是取代互联网](#151区块链不是取代互联网)
         - [1.5.2.区块链不是万能的](#152区块链不是万能的)
      - [1.6.比特币与区块链](#16比特币与区块链)
         - [1.6.1.比特币与区块链的关系](#161比特币与区块链的关系)
         - [附录：《一种点对点的电子现金支付系统》白皮书](#附录一种点对点的电子现金支付系统白皮书)
   - [2.比特币分布式账本初探](#2比特币分布式账本初探)
      - [2.1.货币的发展阶段](#21货币的发展阶段)
      - [2.2.钱包、私钥、签名与交易](#22钱包私钥签名与交易)
         - [2.2.1.比特币的地址、私钥](#221比特币的地址私钥)
         - [2.2.2.比特币的钱包](#222比特币的钱包)
         - [2.2.3.比特币的交易](#223比特币的交易)
      - [2.3.非对称加密如何避免记假账](#23非对称加密如何避免记假账)
      - [2.4.Hash算法](#24hash算法)
         - [2.4.1.哈希运算特征](#241哈希运算特征)
         - [2.4.2.哈希运算在区块链中的作用](#242哈希运算在区块链中的作用)
         - [2.4.3.Merkle树的作用](#243merkle树的作用)
      - [2.5.双花问题和UTXO](#25双花问题和utxo)
         - [2.5.1.UTXO](#251utxo)
         - [2.5.2.比特币的分布式区块链账本](#252比特币的分布式区块链账本)
         - [2.5.3.比特币交易规则](#253比特币交易规则)
   - [扩展：区块链100问](#扩展区块链100问)

## 1.什么是区块链

**狭义**来讲，区块链是一种按照**时间顺序**，将数据区块以顺序相连的方式组合成的一种**链式数据结构**，并以密码学方式保证**不可篡改**和**不可伪造**的**分布式账本**。

**广义**来讲，区块链是**利用块链式数据结构来验证与存储数据**、**利用共识算法来生成和更新数据**、**利用密码学的方式来保证数据安全**、**利用智能合约来编程和操作数据**的一种**全新的分布式基础架构与计算范式**。

### 1.1.区块链的特点

1. **去中心化**：采取了人手一本账本的`去中心化`的**分布式记账方式**。
2. **防篡改**：每一笔交易都有一个唯一标识，除了记录本次交易信息外，还含有上一笔交易的标识（形成了一个链条）
3. **公开透明**：每个人都拥有一份完整的账本，可以随时对交易信息进行查询
   - 区块链的每笔交易都是公开的，它的匿名指的是每个人的身份是无法被知道的
     - PS：**每个人都在区块链上有个和现实身份无关的虚拟身份，这个虚拟身份做的每件事情都是公开透明的**
4. **共识**：当发现有一笔交易记录错误，需要更改。那么至少需要51%的人同意才能修改，才可以重新记录在每个人的账本中（出问题就少数服从多数）

### 1.2.区块链起源与现状

#### 1.2.1.早期技术

1. **密码朋克**：做一个保护隐私的软件（使用密文保护隐私）
2. **Ecash** (匿名现金支付系统)：支付方是匿名的，收款方非匿名
3. **哈希现金**：起初是为了解决垃圾邮件的问题，其工作量证明系统解决了数字货币不被重复交易的问题（计算机在获得信息之前做一定的工作量计算，来避免重复交易）
4. **时间戳**：保证数据货币安全问题，可以保证文件先后顺序（虚拟货币被交易时，会盖上一个时间戳，最终按照区块生成时间的先后顺序相连成区块链）

#### 1.2.2.区块链的现状

中本聪对Ecash进行了优化，综合了**时间戳**、**工作量证明机制**、**非对称加密**技术、**UTXO的结构**，最终发明了比特币。而比特币底层技术就是**区块链**。

区块链从诞生到现在经历了三个阶段：

1. 区块链1.0 ==> `数字货币`，以**比特币**为代表的去中心化的数字支付。
   - eg：比特币、莱特币、山寨币
2. 区块链2.0 ==> `智能合约`，以**以太坊**为代表的支持用户自己编写智能合约，构建去中心化的应用DAPP。
3. 区块链3.0 ==> `延伸到各个领域`，将区块链用到各行业具体的场景中。
   - eg：物联网、医疗、工艺

![三个阶段](https://img2020.cnblogs.com/blog/1492185/202104/1492185-20210425221419464-952625967.png)

#### 1.2.3.区块链未来发展

未来发展主要呈现两大趋势：

1. 广泛被应用：许多行业和政府都能找到区块链的落地场景
   - eg：金融行业、学术领域、物联网行业
2. 加强治理：区块链现在处于关键节点，国家出台了多项的文件和政策加强区块链的治理
   - 专注技术落地，服务实体经济：国家知识产权局、工信部、卫生健康委员会、财政部、商务部等12部委、最高人民法院、地方政府相关政策

### 1.3.信任建立与形象解释

#### 1.3.1.信任的建立

传统社会信任的建立主要是四种方式：**血缘**（先天就确认了关系，后天难获得）、**道德**（可执行性差）、**霸权**（缺乏公允性）、**宗教**（太虚幻）
> 建立稳定的信任：**用权威的手段引入第三方背书**

在区块链中会采用技术手段提供第三方背书，eg：**共识**（共同制定规则）、**共治**（共同管理系统）、**共享**（共享数据等来建立可靠的信任关系）

扩展：**中心化**：中心决定节点，节点必须依赖中心，节点离开中心就没法存在。
> PS：区块链本质就是一个去中心化的分布式账本

#### 1.3.2.区块链的定义

**狭义**来讲，区块链是一种按照**时间顺序**，将数据区块以顺序相连的方式组合成的一种**链式数据结构**，并以密码学方式保证**不可篡改**和**不可伪造**的**分布式账本**。

**广义**来讲，区块链是**利用块链式数据结构来验证与存储数据**、**利用共识算法来生成和更新数据**、**利用密码学的方式来保证数据安全**、**利用智能合约来编程和操作数据**的一种**全新的分布式基础架构与计算范式**。

---

区块链本质上是一个**去中心化的分布式账本**，如果说区块链是账本，那么构成区块链的每一区块就是账本的每一页，每增加一个区块，账本的后面就会增加一页，区块链有多长，账本就有多厚。（`区块链 = 区块 + 链`）
> PS：这个账本存储在网络各个节点的手里，而不是统一存储在一个中心节点，并且是任何人都可以看得到的公开账本。（**区块链高度就相当于账本的页数，区块就相当于账本的一页，链就相当于记账本**）

#### 1.3.3.区块链的分类

根据节点的加入或者退出，是否需要批准分为（区块链开放程度）：
> PS：节点就是网络的骨干，用来验证和记录交易（通常提到的节点是区块链中的计算机，包括手机、矿机、台式机和服务器等）

1. **公有链**：公开的区块链，所有人都可以作为网络中的一个节点自由的加入或退出，节点之间基于共识机制展开工作。是真正意义上完全的去中心化。
2. **私有链**：一般用于企业内部，系统的运作规则、节点的读取和修改权限根据企业的要求进行设定。
3. **联盟链**：一种**多中心化**或者**部分去中心化**的区块链，共识机制受某些指定节点控制，一般是由若干机构联合发起。
   - eg：行业内部，它介于公有链和私有链之间，兼具部分去中心化的特性。

### 1.4.从信息互联网到价值物联网

#### 1.4.1.信息互联网

**信息互联网**：实现了全球网络信息传递（实现了信息的记录、传递，提高了信息流通的速度，降低了信息流通的成本）
> PS：以前的信息传递不仅受到**地域物理限制**，还会受到**中心控制的制度限制**以及**成本限制**，而第一代互联网（信息互联网）就是解决这些问题的 ==> 它依靠**硬件**以及更重要的**TCP/IP**这样的**基础协议**，保证**信息全球传递通道**的实现

信息互联网存在的问题：**数字壁垒、信任缺失**等问题
> PS：信息互联网的基本特征：有价值，但是没有使用价值

1. **身份无法自证**：无法跟信息互联网的对方证明，现在是你在和对方聊天
   - PS：和你聊天的人可能是一只狗
2. **信息的真实性无法保证**：每个人都可以上传信息，而这些信息都具有可复制性。而且复制成本很低，于是使得造假成本几乎为零，而没法证明造假人身份，又加剧了这个问题。
3. **数字壁垒**：很多行业和领域的数据被封闭在各个系统内部，对整个社会来说就是一个个的数据孤岛。

#### 1.4.2.价值物联网

价值物联网：为了**保护信息真实性**、**使数字化的价值**也可以像信息一样**在互联网上自由流通和传输**就提出了价值物联网的概念
> PS：通过**建立区块链价值传输协议**，利用**上链数据不可篡改**（数据篡改难度过大、代价过高）的特点，确保网络中数据的真实性

流通和传输其实可以看做交易行为：

eg：`信息互联网时代`：你为了买一套新房子，现在需要买一套房子。你首先要找到中介，等买家出现后签署买卖合同并支付中介费，然后还要去房管所变更房产证。然后去买新房子，还需要跑一遍流程，只不过由卖方变成了买方
> `价值物联网时代`：通过一份智能合约，你和想要买卖房子的人，可以直接进行交易，区块链技术保证交易双方身份可靠且不存在虚假情况

### 1.5.区块链的神话与误解

#### 1.5.1.区块链不是取代互联网

**区块链**虽然被称作第二代互联网（价值互联网），但是区块链不是取代互联网（不是对互联网原本功能进行完全的改变），而**是在原有基础上，保障信息的可靠性**。

#### 1.5.2.区块链不是万能的

区块链不是所有行业都适用，也不代表区块链技术毫无缺陷。

区块链技术不可能同时满足**可扩展**、**去中心**、**安全性**（类比<a href=”https://baike.baidu.com/item/CAP原则” target=”_blank”>CAP原则</a>），只能在三者之间取舍

eg：当我们选择**去中心化**和保证**安全**时 ==> 交易处理的效率将不可避免的降低（当交易的节点不断的增加，交易的过程会更加繁琐，效率更加低下）

### 1.6.比特币与区块链

**比特币是一种数字货币，是一种商品交换的媒介**。
> PS：比特币不依赖指定货币发行机构，而是依据特定算法，通过大量的计算产生（挖矿），其总数量有限（只有2100万个）

第三方的介入会使得交易的流程变得复杂，交易的效率变得更低（联想上面的买卖房子），而且我们不能完全信任第三方。

所以在电子支付日益普及的今天，如何在交易双方在无需第三方辅助下能够安全直接的交易成为了一个值得深思的问题 ==> 要解决这个问题就需要一个独立的电子货币体系，而比特币就在人们去中心化的期待而生。

#### 1.6.1.比特币与区块链的关系

比特币采用了加密技术、P2P网络传输、分布一致性校验等技术的组合有效的实现了点对点支付 ==> 区块链是比特币的底层技术（区块链就是`点对点传输、分布式账本、共识机制、加密算法`等技术的集成应用）
> PS：正是比特币的成功才将区块链带入人们的视野

#### 附录：《一种点对点的电子现金支付系统》白皮书

简版：

点对点的电子现金支付系统白皮书：
> 首先，在个人对个人的转账中，需要有一种能够不依附于第三方定价机构就能判断其价值的电子货币。
> 然后，我们需要有一份去中心化的数字账本，能够把交易记录及存储的交易信息分发给世界各地的计算机，当然，账本的运作方式与其他传统记账方式大致相同。

全文：<https://www.8btc.com/wiki/bitcoin-a-peer-to-peer-electronic-cash-system>

---

## 2.比特币分布式账本初探

### 2.1.货币的发展阶段

实物货币 ==> 记账货币

**货币的本质**：货币唯一的，基本的职能就是**充当交换媒介**。
> 钱/纸币：纸币通常是由国家发行并强制使用的货币，是**货币的一种表现形式**，执行货币作为交换媒介的功能。

货币的发展阶段：**以物易物** ==> **实物货币**（有价值的一般等价物作为货币，比如贝壳、金银） ==> **纸币**（eg：古时候的银票、人民币） ==> **中心化记账货币**（支付宝、微信）
> PS：中心化记账货币（第三方支付）：用户把现金存到微信/支付宝，每次对外支付都由微信或支付宝代理记账，记录每笔交易与余额变化 ==> **移动支付的实质为记账货币**，是通过银行、第三方支付机构、央行负责记账的

### 2.2.钱包、私钥、签名与交易

#### 2.2.1.比特币的地址、私钥

**比特币的所有权是通过私钥和地址来确立的**。**地址类似**于一个**银行账号**的账号，想要给一个人转比特币，只要知道他的比特币地址就可以了。私钥的作用主要是给交易来签名，用来证明这笔交易是由你发起的，别人收到这笔交易，通过验证签名就可以确认交易中涉及的资金是合法的。

根据加密和解密密钥所使用的密码策略不同，可以将密码体制分为：
1. 对称密码体制：一个密码体制中的加密密钥和解密密钥相同，或者由其中一个密钥很容易推算另一个密钥。
2. **非对称密码体制**：**加密密钥不能推出解密密钥**，因此可以将加密密钥公开，这种加密密钥也被称作**公钥密码**。
   - 自从公钥加密被发明之后，一些不可逆的数学函数被提出（只能向一个方向计算，不能反向倒推）比特币使用的**椭圆曲线算法**就是其中的一种

在比特币中**公钥用于接收比特币**，**私钥用于生成**其对应地址上**支付**比特币所必须要**的签名**，**用来确认这些比特币的所有权**。
> PS：具体到**比特币地址的生成**，其实是**先产生私钥**，**私钥通过椭圆曲线算法**这种不可逆的函数来**生成公钥**，然后**公钥再经过一系列不可逆的运算生成地址**。(地址是公钥的hash)

---

私钥的本质其实是一个随机选出来的数字，eg：扔硬币256次，每次记录0/1，就可以得到一个256位的二进制私钥数字（相当于生成`2^256`的随机数）
> PS：平时的随机数是伪随机，程序设计可以参考这个思路，每次在列表中随机一位数，生成一个十多位的私钥随机数

#### 2.2.2.比特币的钱包

私钥的持有者才是比特币的拥有者，那么私钥存放在哪里呢？

**钱包是私钥的容器，是密钥的管理工具**，它只包含密钥而不是确切的某一代币。一个比特币钱包内包含一系列的密钥对，每个密钥对包括一个私钥和公钥。
> PS：钱包的地址就相当于银行账户，想要往钱包里面充币提供钱包地址就行。私钥相当于银行卡密码 ==> 钱包地址是公开的，私钥是隐秘的

比特币钱包有很多种，有PC端的、手机端的，也有专门的硬件钱包，甚至还有用纸写上私钥的纸钱包。我们一般使用的是**软件钱包**，私钥存在一个叫`wallet.dat`的文件中。
> `Wallet.dat`文件其实是用我们自己设置的密码加过密的，登录钱包软件时，需要用户输入密码来对文件解密得到真正的私钥，这时私钥存在钱包程序的内存中，当我们发起一笔交易时，钱包软件去内存中获取这一私钥来对交易进行签名操作。

我们通常还会听说冷钱包和热钱包：

1. **冷钱包**（离线钱包）：从它生成到使用都是在非联网的状态下，这类钱包往往依靠不联网的电脑、手机以及其他硬件设备运行。
   1. 优点：因为不联网所以可以避开黑客攻击和木马病毒。
   2. 缺点：使用起来比较麻烦，如果要发送交易，需要中介来交换交易信息和签名数据，成本比较高。
2. **热钱包**：在联网状态下使用的，以在线钱包和交易平台钱包等形式出现。
   1. 优点：使用方便，成本低。
   2. 缺点：因为联网，所以外界可以通过互联网访问到你存储私钥的为准，存在被黑客攻击的可能性。

#### 2.2.3.比特币的交易

从一个比特币钱包向另一个中转账，每笔交易都有数字签名来保证安全。一个交易一旦发生，那么就是对所有人都公开的，每个交易的历史可以最终追溯到相应的比特币最初被挖出的那个点。用户用钱包中的私钥来签名交易，从而证明他们有交易的输出，也就是其中的比特币。

**比特币是以交易输出的方式存储到区块链中的**。
> PS：比特币不存在于任何地方，即使是硬盘上。持有比特币其实是拥有特定比特币的地址，但所谓的币并不是直接就存在于这个地址中的。世界上没有一个可以摸得着的实物，或者是一个数据文件，可以被叫做比特币的。有的只是各个地址之间的转账记录，余额时增时减。所有的交易都存放在一个非常大的账本文件中，这个文件叫做”区块链”。如果想知道一个比特币地址中的余额，我们需要到区块链中去计算。

**比特币的交易本质是一个包含输入值于输出值的数据结构**。

通过一个例子来看交易中的选项：小明给小张转一些比特币，那么这个交易就有三项信息：

1. **输入**：这里记录了最初小明拥有这些币是从哪些地址转给他的（记录上1个或多个的节点信息）
2. **数目**：这里是小明准备给小张转多少比特币
3. **输出**：小张的比特币地址

除了第一笔交易是矿工挖矿所得，每一笔交易都拥有一个或多个输入，以及一个或多个输出。
> PS：第一笔矿工挖矿的收入交易通常被称为Coinbase，它没有输入，所以输入的哈希总是被标记为0000000...0000；其他的交易，任何一个交易输入都会唯一追溯到区块链上在本区块之前的某个交易哈希，以及索引。

通过交易哈希和索引，即可唯一确定一个未花费的交易输出——UTXO。这样，每一个交易输入都和之前的某个交易输出关联了起来。

想要知道余额不是存储在地址之中的，都需要去区块链中计算出来，那么效率是否很慢？ ==> 直接可以根据输入和输出的差值计算出余额，不用去区块链里面重头溯源的
> PS：比特币本身并没有账户余额这个概念，我们看到的某个地址有多个比特币，其实是比特币钱包根据未花费的交易输出计算出来的

比特币的签名与验签：**签名必须使用私钥，而只有私钥对应的公钥才能验证签名通过**。（比特币中还支持多方签名）
> 其他人没法冒充小张去领钱是因为：只有小张有这个账号地址对应的私钥，其他人只能用小张提供的公钥去验签，而不能去签名领钱。

### 2.3.非对称加密如何避免记假账

**交易验证的环节**：把公钥做哈希看这个值是否与**UTXO**中描述的地址一致，然后再用提供的公钥对交易中提供的签名信息进行验签，以确定交易是**UTXO**的所有者发出的交易。在交易的验证环节，主要用了“非对称加密”中关于签名、验签的功能。
> PS：其中比特币中的公私钥生成以及签名算法ECDSA都是基于椭圆曲线算法的。

**椭圆曲线算法**：椭圆曲线密码学简称ECC，是一种建立公开密钥加密的算法(非对称加密)。类似的还有RSA ， ElGamal算法等。**ECC被公认为在给定密钥长度下最安全的加密算法**。
> PS：椭圆曲线实际上是一个总称，是一种数学基础算法，不是真正用在密码学上的密码算法。许多非对称加密算法，例如RSA、椭圆曲线，能够被大家认可使用，是因为每种加密算法在数学.上都有一一个运算，而这个运算的逆过程被证明是数学难题。(`椭圆曲线的难点在于被广泛承认的解决椭圆曲线离散对数问题的困难性上`)

在比特币交易中有**三个保障来避免记假账**：

1. 用私有密钥对交易信息签名，必须用配对的公共密钥验证签名，私用密钥的使用者必须是付款人。
   - PS：`使用非对称加密算法来完成的`
2. 被签名的交易信息在网络上进行广播，所有参与到比特币网络的人都可以接到这笔交易信息，并且可以对交易信息进行验签，确保交易是合法的。
   - PS：`使用非对称加密算法来完成的`
3. 接收到交易信息后，大家会按照约定的规则生成区块，就是一一个数据块，这个数据块中包括所有的交易明细信息，按照merkle树的方式组装起来。
   - PS：`merkle树的数据结构可以很好的保证数据安全`

### 2.4.Hash算法

哈希算法：把任意长度的输入通过散列算法变换成固定长度的输出。
> PS：具体来说就是哈希算法将数据打乱、混合、压缩成一个摘要，使得数据量变小，重新创建一个叫做哈希值的指纹。

#### 2.4.1.哈希运算特征

1. **单向性**：哈希算法必须具备单向性;
   - 只能由输入的数据或者消息计算出一个定长的哈希值，而不能通过这个哈希值反向推算出输入的数据或者消息。（破镜不可重圆）
2. **易用性**（固定长度）：可以根据任意长度的消息计算出固定长度的散列;
   - 哈希算法生成的哈希值的长度必须是固定的，而且是针对任意长度的输入数据。
3. **任意性**：不同的输入就有不同的输出;
   - 无论输入数据的长度大小，都会产生定长的哈希值，这样比对结果就比较快速方便。
   - 哈希算法被发明的目的之一就是根据此需求来的，也成为了哈希算法的一大特性。
   - 可以实现对数据完整性和一致性的判定，只有一模一样的数据经过同一一个哈希运算得到的哈希值才是一样的。
4. **算法效率高**：计算哈希值的时间短；
   - 保证不管数据有多长，都能在可接受的范围内得到哈希结果。

PS：典型的Hash算法是MD系列和SHA系列。哈希算法运用的哈希函数是一类比较成熟的散列函数。

#### 2.4.2.哈希运算在区块链中的作用

普通的指针只是保存结构体在内存中的位置。而哈希指针是不仅要保存**结构体在内存中的位置**，还要保存**结构体的哈希值**。
> PS：好处就是不仅可以找到结构体的位置，还能知道结构体是否被篡改）

比特币背后的技术主要是区块链，而区块链是由一个个区块连接而成，区块链和普通链表的`主要区别`就在于`用哈希指针代替了普通的指针`。**普通链表如果内容发生了改变，指针不会发生改变，而区块链一旦内容发生了变化，后面区块的哈希指针都会发生变化**，类似于多米诺骨牌效应。
> PS：哈希运算能够帮助识别区块数据是否被篡改，区块链的哈希指能够唯一而精准地标识一个区块，区块链中任意节点通过简单的哈希计算都可以获得这个区块的哈希指，计算出的哈希值没有变化也就意味着区块链中的信息没有被篡改。另外，哈希运算还能够帮助把各个区块串连成区块链。每个区块都包含上一个区块的哈希值和下一个区块的值，就相当于通过上一个区块的哈希值挂钩到这一个区块，通过这一个区块的哈希值挂钩到下一个区块，就自然而然形成一个链式结构的区块链。

![哈希指针](https://img2020.cnblogs.com/blog/1127869/202105/1127869-20210526145248191-876416678.png)

哈希运算还可以加密交易地址

#### 2.4.3.Merkle树的作用

什么是Merkle树？它使用的是单向哈希。哈希树的顶部为顶部哈希，亦称根哈希或主哈希。它是通过并联两个子哈希来往树.上爬直到找到根哈希。

**Merkle树的作用**：

1. 可以快速定位每笔交易，由于交易在存储上是线性存储，定位到某笔交易会需要遍历，效率低时间慢，通过这样的二叉树可以快速定位到想要找的交易。
2. 在不需要存储整个数据的情况下，就可以简明地核实交易是否被篡改，从交易到每个二叉树的哈希值，有任何一个数字的变化都会导致根哈希的变化。同时，如果有错误，可以快速定位到错误的地方。

Merkle树看起来非常像二叉树，其叶子节点上的值通常为数据块的哈希值，而非叶子节点上的值，所以有时候`Merkle tree`也表示为`Hash tree`：

> 1. `merkle tree`是一种树状结构，它具有树结构的所有特点;
> 2. `merkle tree`的叶子节点的值是数据集合的单元数据或者是单元数据的哈希值;
> 3. 非叶子节点的值是根据它下面所有叶子节点的值，按照hash算法计算而得出的。

![Merkle树](https://img2020.cnblogs.com/blog/1127869/202105/1127869-20210526150855303-1973296868.png)

挖矿：区块头中有个参数叫随机数Nonce，寻找这个随机数的过程就叫做挖矿
> 网络上任何一台机器只要找到合适的数字填到自己的Nonce位置，使得区块头这6个字段(80个字节)的数据的哈希值符合目标哈希指。

![区块](https://img2020.cnblogs.com/blog/1127869/202105/1127869-20210526152205815-1260806551.png)

### 2.5.双花问题和UTXO

双花问题：一笔钱被花费了两次甚至多次。eg：**数字货币中的双花问题**
> 在数字货币系统中，数字资产本质上是以互联网为基础的虚拟数字，简单来说所谓的数字资产其实就是一串字符，因此它很容易被复制或者多次发送使用，在这种情况下，如果没有中心机构的存在，人们并不能确定一笔资产是否已经被花掉，这就导致系统可能存在同一笔数字资产因不当操作被重复使用的情况。

为了解决双花问题，我们日常的数字资产使用依赖于第三方信任机构进行。这类机构对数据进行中心化管理，由它保管交易总帐，并通过实时修改账户余额的方法来防止双重支付的出现。（第三方机构的最大弊端是验证费用极高）

#### 2.5.1.UTXO

**在比特币系统中是如何避免双花问题的**？矿工在生成区块的时候，会从网络上收集交易信息，交易信息中包含了付款人的私钥签名。矿工首先会验证签名是不是正确的，只有正确的签名才会被认为是付款人认可的支付。然后矿工会从以前的区块链中追溯，看看付款人这次消费的比特币是不是以前没有被消费过。然后记录下付款人可用的比特币余额。这个过程也被称为UTXO机制。

UTXO是`Unspent Transaction Outputs`的缩写，全称叫做**尚未使用的交易输出**：

- U代表Unspent,表示未支付的或尚未使用的，“尚未支付” 指的是这个交易输出还没有出现在其它交易的输入端。
- TX是transaction的缩写，交易是从一个比特币钱包向另一个钱包转账，是唯一可以改变比特币所有权的方式，包含了输入、数目和输出这些基本内容。
- O是Output,是输出的意思，TXO连起来就是指**交易输出**。

比特币里并没有用户帐户的概念：比特币是以交易输出，也就是TXO的形式存在的。我们说自己有多少比特币实际上是指的我们拥有所有权的那些UTXO中所指明的比特币的数量。
> 可以理解为：**没有比特币，只有UTXO**。eg：小明有10个比特币，本质上是当前区块链账本中，有若干笔交易的UTXO项收款人写的是小明的地址，而这些UTXO项的数额总和是10。

#### 2.5.2.比特币的分布式区块链账本

比特币的分布式区块链账本，由一笔一笔的交易形成的，每一笔交易都要花费一笔输入产生一笔输出，而其所产生的输出，就是“未花费过的交易输出”，也就是UTXO。这些交易构成了一组链式结构，所有合法的比特币交易都可以追溯到前一个或多个交易的输出，链条的源头就是挖矿奖励，末尾则是当前未花费的交易输出。

#### 2.5.3.比特币交易规则

除了coinbase交易之外，所有的资金来源都必须来自前面某一个
或者几个交易的UTXO。
●任何- -笔交易的交易输入总量必须等于交易输出总量，等式两边
必须配平。


## 扩展：区块链100问

<https://study.163.com/course/introduction.htm?courseId=1004954004>